/*! mmi-slideshow - v0.0.0 - 2014-12-06
* https://github.com/mallocs/mmi-slideshow
* Copyright (c) 2014 Marcus Ulrich; Licensed MIT */
!function(a){a.widget("mmi.slideshow",{version:"0.0.0",navigationCN:"mmi-navigation",footerCN:"mmi-footer",previousCN:"mmi-previous",previousIconCN:"mmi-icon-previous",nextCN:"mmi-next",nextIconCN:"mmi-icon-next",paginationCN:"mmi-pagination",paginationCircleCN:"mmi-circle",paginationThumbnailCN:"mmi-thumbnail",captionCN:"mmi-caption",selectedCN:"mmi-selected",disabledCN:"mmi-disabled",darkCN:"mmi-dark",insideCN:"mmi-inside",responsiveCN:"mmi-responsive",options:{carouselSel:".mmi-slideshow ul",slideSel:".mmi-slideshow li",startSlide:0,buffer:2,transition:"scroll",transitionSpeed:600,transitionOptions:{},navigation:!0,previousText:!1,nextText:!1,loop:!0,captions:!0,autoHideNavigation:!1,autoHideFooter:!1,dark:!1,insideMode:!1,pagination:!0,sprite:!1,spriteWidth:!1,spriteHeight:!1},_create:function(){this.options=a.extend({},this.options,a(this.element).data()),this.carousel=this.element.children(this.options.carouselSel),this.slides=this.carousel.children(this.options.slideSel),this.currentSlideNumber=parseInt(this.options.startSlide,10),this.count=this.slides.length,this._createWrapper(),this._createNavigation(),this._createFooter(),this.options.captions&&this._createCaption(),this.options.pagination&&this._createPagination(),this.setCurrentSlide(this.currentSlideNumber)},_createWrapper:function(){this.carouselWrapper=this.carousel.wrap('<div style="position:relative; overflow: hidden;"></div>').parent(),this.wrapper=this.carouselWrapper.wrap('<div style="position:relative;"></div>').parent(),this._on(this.wrapper,{mouseenter:"_slideshowMouseInEvent",mouseout:"_slideshowMouseOutEvent"})},_createFooter:function(){if(this.$footer=a("<div>",{"class":this.footerCN}),this.options.autoHideFooter){var b=this;this.$footer.css({display:"none"}),a(this.element).hover(function(){b.$footer.show({duration:300,effect:"fade"})},function(){b.$footer.hide({duration:300,effect:"fade"})})}this.options.insideMode?(this.$footer.addClass(this.insideCN),this.$footer.addClass(this.darkCN)):this.options.dark&&this.$footer.addClass(this.darkCN),this.element.append(this.$footer)},_slideshowMouseInEvent:function(){},_slideshowMouseOutEvent:function(){},_createNavigation:function(){if(this.$previous=a('<span data-slides="previous"></span>'),this.$previous.addClass(this.navigationCN).addClass(this.previousCN),this.options.previousText?this.$previous.html(this.options.previousText):this.$previous.addClass(this.previousIconCN),this._on(this.$previous,{click:"previous"}),this.$next=a('<span data-slides="next"></span>'),this.$next.addClass(this.navigationCN).addClass(this.nextCN),this.options.nextText?this.$next.html(this.options.nextText):this.$next.addClass(this.nextIconCN),this._on(this.$next,{click:"next"}),this.options.autoHideNavigation){var b=this;this.$next.css({display:"none"}),this.$previous.css({display:"none"}),a(this.element).hover(function(){b.showNavigation()},function(){b.hideNavigation()})}this.options.insideMode&&(this.$next.addClass(this.insideCN),this.$previous.addClass(this.insideCN)),(this.options.dark||this.options.insideMode)&&(this.$next.addClass(this.darkCN),this.$previous.addClass(this.darkCN)),this.wrapper.append(this.$next,this.$previous)},_createCaption:function(){this.$caption=a("<div>",{"class":this.captionCN}),this.$footer.append(this.$caption)},_createPagination:function(){this.$pagination=a("<ul>",{"class":this.paginationCN});for(var b,c=0,d=this.count;d>c;c++){if("numbers"===this.options.pagination)b=a('<a href="#" data-slide="'+c+'">'+(c+1)+"</a>");else if("sprite"===this.options.pagination&&this.options.sprite){var e=this.options.spriteWidth?parseInt(this.options.spriteWidth,10):40,f=this.options.spriteHeight?parseInt(this.options.spriteHeight,10):40;b=a('<a href="#" data-slide="'+c+'"></a>').addClass(this.paginationThumbnailCN),b.css({width:e+"px",height:f+"px",background:'url("'+this.options.sprite+'") no-repeat scroll 0 '+-f*c+"px transparent"})}else b=a('<a href="#" data-slide="'+c+'"></a>').addClass(this.paginationCircleCN);var g=a("<li></li>");g[0].appendChild(b[0]),this.$pagination.append(g)}this._on(this.$pagination,{"click a":"_page"}),this.$footer.append(this.$pagination),this.pages=this.$pagination.children(this.count)},_getSlideFromNumber:function(b){return a(this.slides[parseInt(b,10)])},_page:function(b){b.preventDefault();var c=a(b.target).data("slide");this.setCurrentSlide(c)},setPage:function(b){if("undefined"!=typeof this.pages){var c=a(this.pages[parseInt(b,10)]);this.pages.not(c).find("a").removeClass(this.selectedCN),c.find("a").addClass(this.selectedCN)}},next:function(){var a=this.currentSlideNumber+1;if(a>=this.count){if(!this.options.loop)return;a=0}this.setCurrentSlide(a)},previous:function(){var a=this.currentSlideNumber-1;if(0>a){if(!this.options.loop)return;a=this.count-1}this.setCurrentSlide(a)},showNavigation:function(a){a=a||200,this.$next.show("fade",a),this.$previous.show("fade",a)},hideNavigation:function(a){a=a||200,this.$next.hide("fade",a),this.$previous.hide("fade",a)},setCaption:function(a){a=a?a:"&nbsp;","undefined"!=typeof this.$caption&&this.$caption.html("<p>"+a+"</p>")},showCaption:function(){this.$caption.show()},hideCaption:function(){this.$caption.hide()},_bufferSlides:function(b){var c=this;this.slides.slice(this.currentSlideNumber+1,this.currentSlideNumber+b+1).each(function(b,d){c._loadSlide.call(c,a(d))})},setCurrentSlide:function(b){var c=this._getSlideFromNumber(b);this._loadSlide(c);var d=a(c.children()[0]),e=parseInt(this.options.transitionSpeed,10),f=this.options.transitionOptions,g=this.options.transition+"",h=!1;if("undefined"==typeof this.currentSlide)c.show(),this.carousel.find("li").not(c).css({display:"none"});else if("scroll"===g){var i;this.carouselWrapper.is(":animated")?(this.carouselWrapper.stop(),e=this.transitionSpeed=this.transitionSpeed/2||e/2,i=this.currentTarget,h=!0):(this.carousel.find("li").css({"float":"left",display:"list-item"}),this.carousel.css({minWidth:"10000em"}),i=this.currentTarget=c.position().left+this.carouselWrapper.scrollLeft()),this.carouselWrapper.animate({scrollLeft:i},e)}else{if(c.is(":animated"))return;if(c.find("img")[0]&&c.find("img")[0].complete===!1&&!this.carouselWrapper.is(":animated")){this.carousel.width(this.currentSlide.width()),this.carousel.height(this.currentSlide.height());var j;c.find("img").load(function(){j.carousel.removeAttr("width"),j.carousel.removeAttr("height")})}this.carousel.find("li").not(this.currentSlide).css({display:"none",position:"static"}),c.show("fade",f,e),this.currentSlide.css({position:"absolute",top:0,left:0}),this.currentSlide.hide(g,f,e)}this.setCaption(d.data("caption")),this.setPage(b),this.currentSlide=c,this.currentSlideNumber=b,h||this._bufferSlides(parseInt(this.options.buffer,10))},_loadSlide:function(b){if("undefined"==typeof b.slideIsLoaded&&b.slideIsLoaded!==!0){var c=a(b.children()[0]);c.is("img")&&this._loadImage(c),b.slideIsLoaded=!0}},_loadImage:function(a){void 0===a.attr("src")&&void 0!==a.data("src")&&a.attr("src",a.data("src"))},_setOption:function(a,b){this._super(a,b),"controls"===a&&(b?this.showNavigation():this.hideNavigation()),"captions"===a&&(b?this.showCaption():this.hideCaption())},_destroy:function(){}})}(jQuery);